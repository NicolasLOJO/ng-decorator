# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs:
    # The Node.js orb contains a set of prepackaged CircleCI configuration you can utilize
    # Orbs reduce the amount of configuration required for common tasks.
    # See the orb documentation here: https://circleci.com/developer/orbs/orb/circleci/node
    node: circleci/node@4.7

jobs:
    build-and-test:
        docker:
            - image: cimg/node:16.10
        steps:
            - checkout
            - node/install-packages:
                  pkg-manager: yarn
            - run:
                  name: Run tests
                  command: npm test
            - run:
                  name: Run Build
                  command: npm run build
            - run: cd dist
            - run:
                  name: Publish to NPM
                  command: |
                      npm set //registry.npmjs.org/:_authToken=$NPM_TOKEN
                      npm publish

workflows:
    sample:
        jobs:
            - build-and-test
